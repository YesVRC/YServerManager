@using Dashboard.Services

@if (Path is not null)
{
        <MudTreeViewItem T="string" Text="@(FullPath ? Path : Path.Split("/").Last())" ExpandedChanged="@OnClickGetFiles" Icon="@Icons.Material.Filled.Folder">
            @if (_files is not null)
            {
                @foreach (string file in _files)
                {
                    @if (File.GetAttributes(file).HasFlag(FileAttributes.Directory))
                    {
                        <DirectoryTreeView Path="@file"/>
                    }
                    else
                    {
                        string fileName = System.IO.Path.GetFileName(file);
                        <MudTreeViewItem T = "string" Text="@fileName" Icon="@IconFromFileType(fileName)"/>
                    }
                }
            }
        </MudTreeViewItem>
}

@code {
    [Parameter] public string? Path { get; set; }
    [Parameter] public bool FullPath { get; set; }
    IEnumerable<string>? _files;
    private void OnClickGetFiles(bool expanded)
    {
        if (Path != null || _files != null) _files = DirectoryHelpers.GetFlatDirectory(Path);
    }

    private string IconFromFileType(string file) => FileHelpers.GetFileCategory(file) switch
    {
        FileHelpers.FileFormat.Text => Icons.Material.Filled.InsertDriveFile,
        FileHelpers.FileFormat.Archive => Icons.Material.Filled.FolderZip,
        FileHelpers.FileFormat.Audio => Icons.Material.Filled.AudioFile,
        FileHelpers.FileFormat.Video => Icons.Material.Filled.VideoFile,
        FileHelpers.FileFormat.Other => Icons.Material.Filled.Info,
        FileHelpers.FileFormat.Image => Icons.Material.Filled.Image,
        _ => Icons.Material.Filled.Error
    };
    
}